<script src="https://cdn.jsdelivr.net/gh/netizenorg/netnet-standard-library/build/nn.min.js"></script>
<script>
  
/* global nn */

const audio = 'violin_note_D.mp3'
let img = 'one_string_violino.png'

let music

let mouseX_old = nn.mouseX
let mouseX_new

let mousespeed

let autokill_timer

let playing

function setup(){
  nn.get('body').css({ backgroundColor: "black"})
  nn.create('span').
    content("World's Small Violin")
    .addTo('body')
  .css({
    position: 'absolute',
    top: (nn.height / 3),
    left: (nn.width / 4),
    color:"white",
    fontSize: (nn.height / 10),
  })
  
  nn.create('span').
    content("click/tap to start")
    .addTo('body')
  .css({
    position: 'absolute',
    top: (nn.height / 3) + (nn.height / 4),
    left: (nn.width / 2),
    color:"white",
    fontSize: (nn.height / 20),
  })
  .on('click', () => start())
}

function start(){
  document.body.innerText = ""
  nn.get('body').css({ backgroundColor: "navy"})
  //VIOLIN
  nn.create('img')
  .set({
    src: img,
    width: nn.height * 0.75,
    draggable: false,
    //overflow: hidden
  })
  .css({
    position: 'fixed',
    top: -nn.height * 0.15,
  })
  .addTo('body')
  //SOUND
  music = nn.create('audio')
  .set({
    src: audio,
    controls: true,
    //display: none
  })
  .addTo('body')
  
  music.preservesPitch = false
}  

function move(){
  //BOW PRESSURE
  autokill_timer = 10
  mouseX_new = nn.mouseX
  mousespeed = mouseX_new - mouseX_old
  mouseX_old = mouseX_new
  let truespeed = Math.abs(mousespeed / 30)
  music.volume = nn.lerp(music.volume, truespeed, 0.6)
  //PITCH
  let full_length = nn.height 
  music.playbackRate = 1
}

function bow(){
  music.play()
  music.currentTime = 0
  playing = true
}

function release(){
  playing = false
  music.pause()
}
  
function animate(){
  if (autokill_timer > 0){
    autokill_timer -= 1
  }
  else{
    release()
  }
  //console.log(autokill_timer)
  requestAnimationFrame(animate)
}
//window.onscroll = function () { window.scrollTo(0, 0); };
nn.on('load', start)
nn.on('mousemove', move)
nn.on('mousedown', bow)
nn.on('mouseup', release)
nn.on('load', animate)
  
</script>